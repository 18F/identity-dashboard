<h1>Configuration Extraction Results</h1>
<p class="usa-prose">Results file: <%= @extract.filename %></p>

<% if @extract.failures.present? %>
  <h2><%= "#{@extract.failures.length} #{@extract.search_by == 'teams' ? 'teams' : 'issuers' }" %>  were invalid </h2>
  <ul class="usa-list">
    <% @extract.failures.each do |f| %>
      <li><%= f %></li>
    <% end %>
  </ul>
<% end %>

<h2><%= @extract.service_providers.length %> ServiceProvider rows found</h2>
<ul class="usa-list font-family-mono">
  <% @extract.service_providers.each do |sp| %>
    <li>service provider <%= sp.group_id %> | <%= sp.issuer %></li>
  <% end %>
</ul>
<h2><%= @extract.teams.length %> Team rows found</h2>
<ul class="usa-list font-family-mono">
  <% @extract.teams.each do |team| %>
    <li>team <%= team.id %> | <%= team.name %></li>
  <% end %>
</ul>
<% if @extract.service_providers.any? %>
  <p>
    A <%= 'partial' if @extract.failures.any?  %> download is ready.
    <%= form_for(@extract, format: :gzip) do |f| %>
      <%= f.hidden_field :ticket, value: @extract.ticket %>
      <%= f.hidden_field :search_by, value: @extract.search_by %>
      <%= f.hidden_field(:criteria_file, value: @extract.criteria_file) if @extract.criteria_file %>
      <%= f.hidden_field(:criteria_list, value: @extract.criteria_list) if @extract.criteria_list %>
      <%= f.submit 'Download configs', class: 'usa-button' %>
    <% end %>
  </p>
<% end %>
